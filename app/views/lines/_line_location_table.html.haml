-#--
-# Copyright (C) 2013  Colin J. Fuller
-#
-# This program is free software: you can redistribute it and/or modify
-# it under the terms of the GNU Affero General Public License as published by
-# the Free Software Foundation, either version 3 of the License, or
-# (at your option) any later version.
-#
-# This program is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-# GNU Affero General Public License for more details.
-#
-# You should have received a copy of the GNU Affero General Public License
-# along with this program.  If not, see <http://www.gnu.org/licenses/>.
-#++

- min_row_count = 4

.row-fluid
  .span9
    %table{class: "table table-striped table-condensed table-bordered"}
      %tr
        %th= LinesController.get_heading(:locations)
        %th= LinesController.get_heading(:current_stock_counts)
        %th= LinesController.get_heading(:stock_clone)
        %th= LinesController.get_heading(:stock_person)
        %th= LinesController.get_heading(:stock_date)
        %th= ""

      - @obj.inventory.each.with_index do |loc, i|
        %tr
          - if readonly? then
            %td= loc.location
            %td= loc.count
            %td= loc.clone
            %td= loc.person
            %td= loc.date
            %td= link_to("Remove one stock", url_for(controller: 'lines', action: :update_number, id: @obj.id, location: loc.json, inc:"-1"), method: "put",  class: "btn btn-warning btn-mini")
          - else
            %td= text_field_tag("location_#{i}", loc.location, class: 'input-medium')
            %td= text_field_tag("count_#{i}", loc.count, class: 'input-medium')
            %td= text_field_tag("clone_#{i}", loc.clone, class: 'input-medium')
            %td= text_field_tag("person_#{i}", loc.person, class: 'input-medium')
            %td= text_field_tag("date_#{i}", loc.date, class: 'input-medium')
            %td

      - if not readonly? then
        - inv_size = @obj.inventory.size
        - (if min_row_count - inv_size < 1 then 1 else min_row_count - inv_size end).times do |i|
          %tr
            %td= text_field_tag("location_#{i+inv_size}", "", class: 'input-medium')
            %td= text_field_tag("count_#{i+inv_size}", "", class: 'input-medium')
            %td= text_field_tag("clone_#{i+inv_size}", "", class: 'input-medium')
            %td= text_field_tag("person_#{i+inv_size}", "", class: 'input-medium')
            %td= text_field_tag("date_#{i+inv_size}", "", class: 'input-medium')
            %td
      - elsif @obj.inventory.empty? then
        %tr
          %td= "No stocks found."
          %td
          %td
          %td
          %td
          %td

